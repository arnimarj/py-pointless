---

jobs:
  include:
    - name: "Unit Tests"
      language: python
      os: linux
      dist: bionic
      python:
        - "3.5"
        - "3.6"
        - "3.7"
        - "3.8"
      env:
        - RUNTESTS=1

    - name: "Build and Upload Linux Wheels"
      os: linux
      dist: bionic
      language: c
      env:
        - RUNTESTS=0

    - name: "Build and Upload MacOS 10.14 Wheels"
      os: osx
      osx_image: xcode11.2
      language: c
      env:
        - RUNTESTS=0

    - name: "Build and Upload MacOS 10.13 Wheels"
      os: osx
      osx_image: xcode10.1
      env:
        - RUNTESTS=0


install:
  - if [[ "$RUNTESTS" == "1" ]]; then python -m pip install -U pip;             fi
  - if [[ "$RUNTESTS" == "1" ]]; then ./build_judy.sh;                          fi
  - if [[ "$RUNTESTS" == "1" ]]; then (cd tests && ./compile.sh);               fi
  - if [[ "$RUNTESTS" == "1" ]]; then pip install -r test-requirements.txt;     fi
  - if [[ "$RUNTESTS" == "1" ]]; then python setup.py install;                  fi

script:
  - if [[ "$RUNTESTS" == "1" ]]; then (cd tests && ./a.out --unit-test-32);     fi
  - if [[ "$RUNTESTS" == "1" ]]; then (cd tests && ./a.out --unit-test-64);     fi
  - if [[ "$RUNTESTS" == "1" ]]; then PYTHONPATH=$(pwd) trial tests.python_api; fi

  - if [[ "$RUNTESTS" == "0" && "$TRAVIS_OS_NAME" == "linux" ]]; then ./build-manylinux.sh; fi
  - if [[ "$RUNTESTS" == "0" && "$TRAVIS_OS_NAME" == "macos" ]]; then ./build-macos.sh;     fi
